// Script de depuración para el analizador de vulnerabilidades
// Ejecutar en la consola del navegador (F12 -> Console)

console.log('=== DIAGNÓSTICO DEL ANALIZADOR DE VULNERABILIDADES ===');

// Verificar que la aplicación esté inicializada
if (window.vulnerabilityApp) {
    console.log('✓ Aplicación inicializada');
    
    // Verificar el estado actual
    const app = window.vulnerabilityApp;
    const currentQuestion = app.questionManager.getCurrentQuestion();
    
    console.log('Pregunta actual:', currentQuestion ? currentQuestion.id : 'null');
    if (currentQuestion) {
        console.log('Título:', currentQuestion.title);
        console.log('Líneas vulnerables:', currentQuestion.vulnerableLines);
        console.log('Tiene vulnerabilidades:', currentQuestion.vulnerableLines.length > 0);
    }
    
    // Verificar el estado del botón
    const verifyButton = document.getElementById('verify-button');
    console.log('Botón encontrado:', !!verifyButton);
    if (verifyButton) {
        console.log('Botón deshabilitado:', verifyButton.disabled);
        console.log('Texto del botón:', verifyButton.textContent);
    }
    
    // Verificar las líneas seleccionadas
    const selectedLines = app.selectionManager.getSelectedLines();
    console.log('Líneas seleccionadas:', selectedLines);
    
    // Verificar el total de preguntas
    const totalQuestions = app.questionManager.getTotalQuestions();
    console.log('Total de preguntas:', totalQuestions);
    
    // Probar manualmente la función onSelectionChange
    console.log('\n=== PROBANDO onSelectionChange MANUALMENTE ===');
    app.onSelectionChange([]);
    
    // Mostrar información de todas las preguntas
    console.log('\n=== INFORMACIÓN DE TODAS LAS PREGUNTAS ===');
    const allQuestions = app.questionManager.getAllQuestions();
    allQuestions.forEach((q, index) => {
        console.log(`Pregunta ${q.id}: ${q.title} - Vulnerabilidades: [${q.vulnerableLines.join(', ')}]`);
    });
    
} else {
    console.log('✗ Aplicación no inicializada');
    console.log('Verificando si los scripts se cargaron...');
    
    // Verificar que las clases estén disponibles
    const classes = ['VulnerabilityAnalyzerApp', 'QuestionManager', 'SelectionManager', 'FeedbackSystem', 'CodeRenderer'];
    classes.forEach(className => {
        console.log(`${className}:`, typeof window[className] !== 'undefined' ? '✓' : '✗');
    });
}

console.log('\n=== FUNCIONES GLOBALES ===');
console.log('previousQuestion:', typeof previousQuestion);
console.log('nextQuestion:', typeof nextQuestion);
console.log('verifyAnswer:', typeof verifyAnswer);

console.log('\n=== ELEMENTOS DOM ===');
const elements = ['verify-button', 'code-block', 'question-title'];
elements.forEach(id => {
    const element = document.getElementById(id);
    console.log(`${id}:`, element ? '✓' : '✗');
});